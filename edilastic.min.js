/*! edilastic 2015-08-20 - alexis.baranger91@gmail.com */
var app=angular.module("edilastic",[]),settings={attrs:{shut:"window",external:null,type:"input",elastic:!0,tid:null,clone:!0},options:{confirmTemplate:'<button type="button" class="btn-edilastic btn-confirm">Confirm</button>',cancelTemplate:'<button type="button" class="btn-edilastic btn-cancel">Cancel</button>',textareaTemplate:'<textarea class="edilastic-open"></textarea>',inputTemplate:'<input class="edilastic-open"/>'}};app.directive("edilastic",["$window","$timeout",function(a,b){return{restrict:"A",scope:{value:"=edilastic",onconfirm:"&",onopen:"&",onclose:"&"},compile:function(c,d){var e=c.attr("class");return function(c,d,f){function g(){var a=this,d=c.$eval(f.options);angular.extend(this,settings.attrs,settings.options,d,{isHover:!1,isOpen:!1});for(var e in settings.attrs)f[e]&&(a[e]=c.$eval(f[e])||f[e]);console.log(this),b(function(){a.initialize()},0)}g.prototype.initialize=function(){var b=this;if("textarea"==b.type?b.input=angular.element(b.textareaTemplate):b.input=angular.element(b.inputTemplate),b.tid&&b.input.attr("id",b.tid),1==b.clone&&(console.log("clone..."),b.input.addClass(e)),b.form=angular.element('<form class="edilastic-form" style="display:none; margin:0px"></form>'),b.form.append(b.input),b.input.on("blur keyup change",b.resize),d.after(b.form),"window"==b.shut){var c=[];if(b.external&&!Array.isArray(b.external))var c=[b.external];else if(b.external&&Array.isArray(b.external))var c=b.external;c.forEach(function(a){var c=angular.element(document.getElementById(a));c.on("mouseenter",function(){b.isHover=!0}),c.on("mouseleave",function(){b.isHover=!1})}),d.on("mouseenter",function(){b.isHover=!0}),d.on("mouseleave",function(){b.isHover=!1}),d.next().children().on("mouseenter",function(){b.isHover=!0}),d.next().children().on("mouseleave",function(){b.isHover=!1}),angular.element(a).on("click",function(){1==b.isHover?b.open():!b.isHover&&b.isOpen&&b.confirm()})}else{if("button"!=b.shut)throw"Error: close value unknown. ("+b.shut+")";d.on("click",b.open);var f=angular.element('<div class="form-group edilastic-group"></div>'),g=angular.element(b.confirmTemplate),h=angular.element(b.cancelTemplate);b.form.append(f),f.append(g),f.append(h),g.on("click",b.confirm),h.on("click",b.close)}},g.prototype.resize=function(){"textarea"==h.type&&1==h.elastic&&(h.input[0].style.height=""+h.input[0].scrollHeight+"px")},g.prototype.open=function(){h.isOpen||(h.isOpen=!0,h.input.val(c.value),b(h.resize,0),h.form.css("display",""),d.css("opacity",0),b(function(){d.css("display","none")},0),c.onopen&&"function"==typeof c.onopen&&c.$apply(function(){c.onopen()}))},g.prototype.close=function(){h.form.css("display","none"),d.css("opacity",1),d.css("display",""),h.isOpen=!1,c.onclose&&"function"==typeof c.onclose&&c.$apply(function(){c.onclose()})},g.prototype.confirm=function(){return h.input.val()==c.value?h.close():(c.$apply(function(){c.value=h.input.val()}),h.close(),void(c.onconfirm&&"function"==typeof c.onconfirm&&c.$apply(function(){c.onconfirm()})))};var h=new g}}}}]);